{
  "id": "2017-09-08-headless-testing-with-firefox",
  "title": "Headless testing with Firefox",
  "date": "2017-09-08",
  "categories": [
    "Selenium"
  ],
  "tags": [
    "selenium"
  ],
  "permalink": "/2017/09/headless-testing-with-firefox",
  "content": "<p><img src=\"/images/blog/firefox.jpg\" alt=\"\" style=\"width: 100%;\"></p>\n<p>Last week I wanted to show you how to run Selenium tests using headless Firefox. Unfortunately<br>my <a href=\"http://www.awesome-testing.com/2016/02/selenium-browser-capabilities-explained.html\" target=\"_blank\" rel=\"noreferrer\">Browser Capabilities</a>turned out<br>to be outdated so I opted for<br>correct <a href=\"http://www.awesome-testing.com/2017/09/firefox-selenium-browser-capabilities.html\" target=\"_blank\" rel=\"noreferrer\">Firefox Selenium Browser Capabilities</a><br>explanation instead.</p>\n<p>It turned out that most of the work was done already and I just needed few minutes to run Firefox in headless mode. Here<br>is how I did it.</p>\n<h2>Getting started - requirements</h2>\n<p>According to <a href=\"https://developer.mozilla.org/en-US/Firefox/Headless_mode\" target=\"_blank\" rel=\"noreferrer\">official Mozilla guide</a>you need Firefox 55+ on<br>Linux and Firefox 56+ on Windows/Mac.</p>\n<p>I&#39;m currently using Windows, so I had to<br>download <a href=\"https://www.mozilla.org/en-US/firefox/56.0beta/releasenotes/\" target=\"_blank\" rel=\"noreferrer\">Firefox 56 beta</a> first (stable version is 55).</p>\n<h2>Headless Firefox configuration</h2>\n<p>My code from last week was almost sufficient. I only needed to add one option (--headless). Configuration is almost<br>identical as in <a href=\"http://www.awesome-testing.com/2017/05/headless-testing-with-google-chrome.html\" target=\"_blank\" rel=\"noreferrer\">Chrome</a>.</p>\n<pre><code class=\"language-java\">@Override\n        public WebDriver newWebDriver() {\n        return new FirefoxDriver(getFirefoxCapabilities());\n    }\n\n    private DesiredCapabilities getFirefoxCapabilities() {\n        DesiredCapabilities capabilities = DesiredCapabilities.firefox();\n        capabilities.setCapability(FirefoxOptions.FIREFOX_OPTIONS, getFirefoxOptions());\n        return capabilities;\n    }\n\n    private FirefoxOptions getFirefoxOptions() {\n        FirefoxOptions options = new FirefoxOptions();\n        options.addArguments(&quot;--headless&quot;);\n        return options;\n    }\n</code></pre>\n<h2>Demo</h2>\n<p>As usual, I prepared quick demo for my readers. I run it few times in headless/non-headless mode on my local machine and<br>didn&#39;t observe any time differences. Still the main benefit of headless testing is ease of use on Unix machines. We<br>don&#39;t have to install xvfb and other tools related to graphic environment.</p>\n<p>Demo is testing that only 5 posts is displayed on my homepage.</p>\n<p>PageObject code:</p>\n<pre><code class=\"language-java\">@PageUrl(&quot;http://www.awesome-testing.com&quot;)\npublic class AwesomeTestingPage extends FluentPage {\n\n    @FindBy(css = &quot;[alt=&#39;Awesome Testing&#39;]&quot;)\n    private FluentWebElement logo;\n\n    @FindBy(css = &quot;h1.post-title&quot;)\n    private FluentList&lt;FluentWebElement&gt; postTitle;\n\n    @Override\n    public void isAt() {\n        await().atMost(5, TimeUnit.SECONDS).until(logo).displayed();\n    }\n\n    public void assertThatCorrectNumberOfPostsIsDisplayed(int numberOfPosts) {\n        await().until(postTitle).displayed();\n        assertThat(postTitle.size()).isEqualTo(numberOfPosts);\n    }\n}\n</code></pre>\n<p>Class in which I configure Firefox browser:</p>\n<pre><code class=\"language-java\">public class FirefoxManipulator extends FluentTestNg {\n\n    private static final String MY_GECKO_PATH = &quot;C:\\\\drivers\\\\geckodriver.exe&quot;;\n\n    @BeforeTest\n    public void setUp() {\n        if (SystemUtils.IS_OS_WINDOWS) {\n            System.setProperty(&quot;webdriver.gecko.driver&quot;, MY_GECKO_PATH);\n        }\n    }\n\n    @Override\n    public WebDriver newWebDriver() {\n        return new FirefoxDriver(getFirefoxCapabilities());\n    }\n\n    private DesiredCapabilities getFirefoxCapabilities() {\n        DesiredCapabilities capabilities = DesiredCapabilities.firefox();\n        capabilities.setCapability(FirefoxOptions.FIREFOX_OPTIONS, getFirefoxOptions());\n        return capabilities;\n    }\n\n    private FirefoxOptions getFirefoxOptions() {\n        FirefoxOptions options = new FirefoxOptions();\n        options.addArguments(&quot;--headless&quot;);\n        return options;\n    }\n}\n</code></pre>\n<p>Actual test code:</p>\n<pre><code class=\"language-java\">public class HeadlessFirefoxDemoTest extends FirefoxManipulator {\n\n    private static final int EXPECTED_NUMBER_OF_POSTS = 5;\n\n    @Page\n    private AwesomeTestingPage awesomeTestingPage;\n\n    @Test\n    public void correctNumberOfPostsShouldBeDisplayed() {\n        goTo(awesomeTestingPage)\n                .assertThatCorrectNumberOfPostsIsDisplayed(EXPECTED_NUMBER_OF_POSTS);\n    }\n\n}\n</code></pre>\n<p>As usual, I posted all the code from above in<br>my<a href=\"https://github.com/slawekradzyminski/AwesomeTesting\" target=\"_blank\" rel=\"noreferrer\">GitHub Awesome Testing project</a>.</p>\n"
}