{
  "id": "2018-11-15-continuous-security-with-find-sec-bugs",
  "title": "Continuous Security with Find-Sec-Bugs",
  "date": "2018-11-15",
  "category": "Security",
  "permalink": "/2018/11/continuous-security-with-find-sec-bugs",
  "content": "<img src=\"/images/blog/16162781.png\" alt=\"\">\n\n<p>One of the hardest software quality characteristic to cover in automated tests is security. In my <a href=\"https://www.awesome-testing.com/2017/03/automated-testing-vs-manual-testing.html\" target=\"_blank\" rel=\"noreferrer\">Automated testing vs manual testing - security perspective</a> blog I have mentioned that it&#39;s almost impossible to rely solely on automation, especially in cases where human factor is involved (phishing, social engineering or plain ignorance).</p><p>It doesn&#39;t change the fact that some aspects of security can, or even should be automated. The easiest starting point is dependencies. For Java projects, you can use OWASP Dependency Checker (see my <a href=\"https://www.awesome-testing.com/2017/02/continuous-security-with-owasp.html\" target=\"_blank\" rel=\"noreferrer\">blog post</a>for more details) and for npm projects consider using <a href=\"https://docs.npmjs.com/cli/audit\" target=\"_blank\" rel=\"noreferrer\">audit</a>.</p><p>Certain vulnerabilities can be tested daily in the regression test suite. You can see here how to <a href=\"https://www.awesome-testing.com/2017/11/automate-your-xss-tests-with-selenium.html\" target=\"_blank\" rel=\"noreferrer\">Automate your XSS tests with Selenium</a>. The same tool can be used to test <a href=\"https://www.owasp.org/index.php/Unvalidated_Redirects_and_Forwards_Cheat_Sheet\" target=\"_blank\" rel=\"noreferrer\">Unvalidated redirects</a>. I&#39;ll show how on my blog soon.</p><p>Today I&#39;d like to present you a tool called <a href=\"https://find-sec-bugs.github.io/\" target=\"_blank\" rel=\"noreferrer\">Find Security Bugs</a>which detects <a href=\"https://find-sec-bugs.github.io/bugs.htm\" target=\"_blank\" rel=\"noreferrer\">128 bug patterns</a>just by reading your Java code. The described tool can be used also as <a href=\"https://plugins.jetbrains.com/plugin/3847-findbugs-idea\" target=\"_blank\" rel=\"noreferrer\">IntelliJ plugin</a>, <a href=\"https://github.com/spotbugs/sonar-findbugs\" target=\"_blank\" rel=\"noreferrer\">Sonar extension</a>, but in this post, I&#39;ll cover <a href=\"https://github.com/spotbugs/spotbugs-maven-plugin\" target=\"_blank\" rel=\"noreferrer\">Maven integration</a>.</p><h2>Setup</h2>\n<p>Introducing find-sec-bugs plugin into your Maven projects is very simple. Here is the example configuration which you need to add into pom.xml file.</p><pre><code class=\"hljs language-xml\">\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">build</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">plugins</span>&gt;</span>\n            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">plugin</span>&gt;</span>\n                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>com.github.spotbugs<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span>\n                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>spotbugs-maven-plugin<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span>\n                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>3.1.8<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span>\n                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">configuration</span>&gt;</span>\n                    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">effort</span>&gt;</span>Max<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">effort</span>&gt;</span>\n                    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">threshold</span>&gt;</span>Low<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">threshold</span>&gt;</span>\n                    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">failOnError</span>&gt;</span>true<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">failOnError</span>&gt;</span>\n                    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">includeFilterFile</span>&gt;</span>src/test/resources/spotbugs-security-include.xml\n                    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">includeFilterFile</span>&gt;</span>\n                    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">excludeFilterFile</span>&gt;</span>src/test/resources/spotbugs-security-exclude.xml\n                    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">excludeFilterFile</span>&gt;</span>\n                    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">plugins</span>&gt;</span>\n                        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">plugin</span>&gt;</span>\n                            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>com.h3xstream.findsecbugs<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span>\n                            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>findsecbugs-plugin<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span>\n                            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>LATEST<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span> <span class=\"hljs-comment\">&lt;!-- Auto-update to the latest stable --&gt;</span>\n                            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">executions</span>&gt;</span>\n                                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">execution</span>&gt;</span>\n                                    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">phase</span>&gt;</span>package<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">phase</span>&gt;</span>\n                                    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">goals</span>&gt;</span>\n                                        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">goal</span>&gt;</span>check<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">goal</span>&gt;</span>\n                                    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">goals</span>&gt;</span>\n                                <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">execution</span>&gt;</span>\n                            <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">executions</span>&gt;</span>\n                        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">plugin</span>&gt;</span>\n                    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">plugins</span>&gt;</span>\n                <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">configuration</span>&gt;</span>\n            <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">plugin</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">plugins</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">build</span>&gt;</span>\n</code></pre><p>The configuration is quite long, so let&#39;s explain few things. First of all, find-sec-bugs extends Maven extension which is available for quite some time - <a href=\"https://spotbugs.github.io/spotbugs-maven-plugin/\" target=\"_blank\" rel=\"noreferrer\">SpotBugs Maven Plugin</a>. It&#39;s a tool that reads your code and looks for bugs (bad practices, too complicated logic, code smells, etc).</p><p>Configuration values are explained on the<a href=\"https://spotbugs.readthedocs.io/en/stable/ant.html?highlight=threshold\" target=\"_blank\" rel=\"noreferrer\">extension page</a>. The most useful is the <em>failOnError</em> flag which allows you to add described tool into Continuous Integration (CI) pipeline. If the analysis finds a security bug the build fails.</p><p>The Analysis can be narrowed down to scope which interests us. Here we focus only on security.</p><p>spotbugs-security-include.xml will look like this:</p><pre><code class=\"hljs language-xml\">\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">FindBugsFilter</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">Match</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">Bug</span> <span class=\"hljs-attr\">category</span>=<span class=\"hljs-string\">&quot;SECURITY&quot;</span>/&gt;</span>\n    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">Match</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">FindBugsFilter</span>&gt;</span>\n</code></pre><p>And spotbugs-security-exclude.xml will look like this:</p><pre><code class=\"hljs language-xml\">\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">FindBugsFilter</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">FindBugsFilter</span>&gt;</span>\n</code></pre><p>Finally, there is findsecbugs-plugin which we trigger in the following way:</p><p>a) CI purposes </p><p><code>mvn package -DskipTests=true findbugs:check</code></p><p>b) Verification purposes (human-readable report will be generated after triggering this command)</p><p><code>mvn findbugs:gui</code></p><p>As usual, I have added every piece of code into my <a href=\"https://github.com/slawekradzyminski/AwesomeTesting/commit/293b152920975af246699f5b74a2ad2e581f8a63\" target=\"_blank\" rel=\"noreferrer\">Github project</a>.</p><h2>Demo</h2>\n<p>If you try to run mvn commands in my projects you won&#39;t be able to observe anything interesting. The final report would be empty meaning there are no security vulnerabilities in analyzed code.</p><p>To observe find-sec-bugs in action let&#39;s download <a href=\"https://github.com/WebGoat/WebGoat\" target=\"_blank\" rel=\"noreferrer\">OWASP WebGoat</a>project. It&#39;s made insecure by design so we expect to find something this time.</p><p>Now do few things:</p><p>a) Run <code>mvn clean install -DskipTests=true</code> in whole WebGoat project</p><p>b) Go to <code>cd webgoat-lessons/insecure-deserialization</code></p><p>c) Update pom.xml as mentioned in point 2.</p><p>d) Add spotbugs-security-include.xml and spotbugs-security-exlude.xml files to proper paths (they need to match pom.xml configuration)</p><p>e) Run <code>mvn findbugs:gui</code></p><p>You should see report like this. As you can see the presented tool was able to find a bug in tested module.</p><img src=\"/images/blog/serialisation.png\" alt=\"\">\n\n<h2>Credits</h2>\n<p>The following blog post was inspired by <a href=\"https://www.testwarez.pl/dyi-regular-security-audit-without-pentesters/\" target=\"_blank\" rel=\"noreferrer\">Michał Kowalski TestWarez presentation</a>. Thanks :)</p>"
}