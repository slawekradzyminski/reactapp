{
  "id": "2015-12-13-testing-with-ansible",
  "title": "Testing with Ansible",
  "date": "2015-12-13",
  "categories": [
    "TestOps"
  ],
  "tags": [
    "testing",
    "orchestration",
    "testops",
    "test automation",
    "testing tools",
    "automation",
    "ansible"
  ],
  "permalink": "/2015/12/testing-with-ansible",
  "content": "<p><img src=\"/images/blog/CONTINUOUS-DELIVERY-2.png\" alt=\"\"></p><p>IEEE Spectrum has recently posted an article about <a href=\"http://spectrum.ieee.org/view-from-the-valley/computing/software/yahoos-engineers-move-to-coding-without-a-net\" target=\"_blank\" rel=\"noreferrer\">Yahoo resigning from the QA team</a>.<br>After that maneuver quality of the final product not only didn&#39;t degrade but actually improved. Of course, if we delve deeper into the article we will realize that the products got better after continuous delivery introduction (image credit to<a href=\"http://www.cloudofit.com/\" target=\"_blank\" rel=\"noreferrer\">www.cloudofit.com</a>) and the QA team wasn&#39;t entirely to blame. However, that&#39;s a clear signal to old school testers that programming/scripting skills are now necessary.</p><p>One of my favorite tools that support Continuous Delivery (or Deployment if we assume what deploy to production is automatic) is <a href=\"http://www.ansible.com/how-ansible-works\" target=\"_blank\" rel=\"noreferrer\">Ansible</a>. This simple automation agent allows us to execute commands on external hosts via plays, which can later be organized to playbooks (list of plays). This is how example playbook looks like:</p><pre><code class=\"hljs language-yaml\"><span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">hosts:</span> <span class=\"hljs-string\">droplets</span>\n  <span class=\"hljs-attr\">tasks:</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">Installs</span> <span class=\"hljs-string\">nginx</span> <span class=\"hljs-string\">web</span> <span class=\"hljs-string\">server</span>\n      <span class=\"hljs-attr\">apt:</span> <span class=\"hljs-string\">name=nginx</span> <span class=\"hljs-string\">force=yes</span> <span class=\"hljs-string\">update_cache=true</span>\n\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">start</span> <span class=\"hljs-string\">nginx</span>\n      <span class=\"hljs-attr\">service:</span> <span class=\"hljs-string\">name=nginx</span> <span class=\"hljs-string\">state=started</span></code></pre><p>What is this playbook doing?</p><p>a) it checks hosts file for <code>[droplets]</code> string and connects to IP addresses below. Hosts file example:</p><pre><code class=\"hljs language-yaml\">[<span class=\"hljs-string\">droplets</span>]\n<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.0</span><span class=\"hljs-number\">.2</span> <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.0</span><span class=\"hljs-number\">.3</span>\n[<span class=\"hljs-string\">webservers</span>]\n<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.3</span><span class=\"hljs-number\">.222</span></code></pre><p>b) apt-get update is called (<code>update_cache=true</code>)<br></p><p>c) <code>apt-get install nginx</code> is called with automatic confirmation (<code>name=nginx force=yes</code>)<br></p><p>d) nginx service is started<br><br><br><br>With very few lines we were able to install the necessary applications on two hosts. Imagine how much time you&#39;ll save if the number of machines would be bigger. Probably you have already realized how powerful Ansible can it be to testing, but let me give you a few more examples:<br><br><br></p><ul>\n<li>Environment setup (see example above)<br></li>\n<li>Updating app configuration on all testing servers<br></li>\n</ul>\n<pre><code class=\"hljs language-yaml\"><span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">hosts:</span> <span class=\"hljs-string\">test_machines</span>\n  <span class=\"hljs-attr\">tasks:</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">Update</span> <span class=\"hljs-string\">config</span>\n      <span class=\"hljs-attr\">template:</span> <span class=\"hljs-string\">src=config.xml.j2</span> <span class=\"hljs-string\">dest={{</span> <span class=\"hljs-string\">app_folder</span> <span class=\"hljs-string\">}}/config.xml</span></code></pre><ul>\n<li>Jenkins / Selenium Grid / Selenium nodes auto-configuration</li>\n<li>Smoke tests after prod deployment</li>\n</ul>\n<pre><code class=\"hljs language-yaml\"><span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">hosts:</span> <span class=\"hljs-string\">PROD_machines</span>\n  <span class=\"hljs-attr\">tasks:</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">Check</span> <span class=\"hljs-string\">service</span>\n      <span class=\"hljs-attr\">service:</span> <span class=\"hljs-string\">name=vsftpd</span> <span class=\"hljs-string\">state=started</span></code></pre><ul>\n<li>Running commands and checking the output</li>\n</ul>\n<pre><code class=\"hljs language-yaml\"><span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">hosts:</span> <span class=\"hljs-string\">test_machines</span>\n  <span class=\"hljs-attr\">tasks:</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">Run</span> <span class=\"hljs-string\">X</span>\n      <span class=\"hljs-attr\">shell:</span> <span class=\"hljs-string\">usr/bin/somefancycommand</span>\n      <span class=\"hljs-attr\">register:</span> <span class=\"hljs-string\">cmd_result</span>\n\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">assert</span> <span class=\"hljs-string\">results</span>\n      <span class=\"hljs-attr\">that:</span> <span class=\"hljs-string\">&quot;not ready not in cmd_result.stderr&quot;</span></code></pre><p>Free knowledge:<br></p><ul>\n<li><a href=\"http://tomoconnor.eu/blogish/getting-started-ansible\" target=\"_blank\" rel=\"noreferrer\">http://tomoconnor.eu/blogish/getting-started-ansible</a></li>\n<li><a href=\"https://serversforhackers.com/an-ansible-tutorial\" target=\"_blank\" rel=\"noreferrer\">https://serversforhackers.com/an-ansible-tutorial</a></li>\n<li><a href=\"http://ryaneschinger.com/blog/ansible-quick-start/\" target=\"_blank\" rel=\"noreferrer\">http://ryaneschinger.com/blog/ansible-quick-start/</a></li>\n<li><a href=\"http://docs.ansible.com/ansible/intro_getting_started.html\" target=\"_blank\" rel=\"noreferrer\">http://docs.ansible.com/ansible/intro_getting_started.html</a></li>\n</ul>\n"
}