{
  "id": "2019-03-30-disabling-javascript-using-selenium",
  "title": "Disabling JavaScript using Selenium",
  "date": "2019-03-30",
  "categories": [
    "Selenium"
  ],
  "tags": [
    "selenium"
  ],
  "permalink": "/2019/03/disabling-javascript-using-selenium",
  "content": "<p><img src=\"/images/blog/pobrane2.png\" alt=\"\" style=\"width: 100%;\"></p>\n<h2>Introduction</h2>\n<p>Some days ago I was looking for an easy way to disable JavaScript using chromedriver. It turned out to be surprisingly<br>hard and once again I had to find<br>proper <a href=\"https://src.chromium.org/viewvc/chrome/trunk/src/chrome/common/pref_names.cc?view=markup\" target=\"_blank\" rel=\"noreferrer\">Chrome preference</a>in<br>the Chromium source code. If you ever wonder how to do something with your Chrome using Selenium I recommend my<br>own <a href=\"https://www.awesome-testing.com/2016/02/selenium-browser-capabilities-explained.html\" target=\"_blank\" rel=\"noreferrer\">Browser Capabilities explained</a><br>post which has a lot of examples and links where to look for.</p>\n<h2>Why is Javascript-disabled page worth testing?</h2>\n<p>Before we move on to Java demo let&#39;s wonder for a while: why do people disable JavaScript?</p>\n<p><em>a) Speed &amp; Bandwidth</em></p>\n<p>Using Internet with an old computer and a slow connection is incredibly frustrating these days. You can try to throttle<br>bandwidth in your Chrome via Developer tools and try it yourself... For your responsibility.</p>\n<p><em>b) Usability &amp; Accessibility</em></p>\n<p>Relying on javascript does not automatically mean the page is not accessible, although it makes it significantly harder<br>for disabled people. Imagine that content blind person wants to find is hidden behind three JS-invoked actions. Would it<br>be possible to access? Yes. Would it be usable? No.</p>\n<p><em>c) Security &amp; Privacy</em></p>\n<p>Any website can use JavaScript to gather information about things you do (or did) during your browsing session and<br>upload them to an external server. That&#39;s enough reason for privacy-concerned people to disable it. JavaScript can also<br>be used for <a href=\"https://www.awesome-testing.com/2017/11/automate-your-xss-tests-with-selenium.html\" target=\"_blank\" rel=\"noreferrer\">XSS attacks</a>.</p>\n<p>So, from the company perspective: why should we care and test our website with JavaScript disabled?</p>\n<p><em>a) SEO</em></p>\n<p>Perhaps the most important reason. If large chunks of your website rely on pure JavaScript chances are search-engines<br>will be ignoring it.</p>\n<p><em>b) Clients who disable JavaScript</em></p>\n<p>The number of people who disable JS is small... but is it negligent? Even if it&#39;s only 1% of our business can we ignore<br>that?</p>\n<p><em>c) Testing for graceful degradation of JavaScript</em></p>\n<p>Even if we decide that we don&#39;t support our site with JS disabled we should gracefully handle it. We can&#39;t leave our<br>users with a forever loading blank site. We have to present information that we don&#39;t support JS.</p>\n<h2>Chrome</h2>\n<p>As I mentioned above I wasn&#39;t able to disable JavaScript in Chrome using any obvious methods (like setters etc.). I had<br>to pass a map of preferences with magic <code>profile.managed_default_content_settings.javascript</code>. I assume that the<br>code is easy to understand. For details please take a look at<br>my <a href=\"https://www.awesome-testing.com/2016/02/selenium-browser-capabilities-explained.html\" target=\"_blank\" rel=\"noreferrer\">Desired Capabilities explained</a><br>post</p>\n<pre><code class=\"language-java\">private static final String PREFS = &quot;prefs&quot;;\nprivate static final String JAVASCRIPT_SETTINGS = &quot;profile.managed_default_content_settings.javascript&quot;;\nprivate static final short DISABLED = 2;\n\n    @Override\n    public WebDriver newWebDriver() {\n        return new ChromeDriver(getChromeOptions());\n    }\n\n    private ChromeOptions getChromeOptions() {\n        ChromeOptions options = new ChromeOptions();\n        options.setExperimentalOption(PREFS, getChromePrefs());\n        return options;\n    }\n\n    private Map&lt;String, Object&gt; getChromePrefs() {\n        Map&lt;String, Object&gt; chromePrefs = new HashMap&lt;&gt;();\n        chromePrefs.put(JAVASCRIPT_SETTINGS, DISABLED);\n        return chromePrefs;\n    }\n</code></pre>\n<p>The test is pretty straightforward. We go to main Facebook page and wait until URL is updated with <code>?_fb_noscript=1</code><br>.This is how FB detects users who have disabled JS.</p>\n<p>I&#39;m using <a href=\"https://github.com/FluentLenium/FluentLenium/\" target=\"_blank\" rel=\"noreferrer\">FluentLenium</a> syntax.</p>\n<pre><code class=\"language-java\">private static final String FACEBOOK_NO_JS_URL = &quot;https://www.facebook.com/?_fb_noscript=1&quot;;\n\n    @Page\n    private FacebookMainPage facebookMainPage;\n\n    @Test\n    public void checkJsDisabled() {\n        facebookMainPage.go();\n        waitForFacebookNoJsUrlAppender();\n    }\n\n    private void waitForFacebookNoJsUrlAppender() {\n        await().atMost(2, TimeUnit.SECONDS).until(\n                () -&gt; getDriver().getCurrentUrl().equals(FACEBOOK_NO_JS_URL));\n    }\n</code></pre>\n<h2>Firefox</h2>\n<p>Firefox setup is much easier. Only one flag has to be set to false: <em>javascript.enabled</em>.</p>\n<pre><code class=\"language-java\">private static final String JAVASCRIPT_ENABLED = &quot;javascript.enabled&quot;;\n\n    @Override\n    public WebDriver newWebDriver() {\n        return new FirefoxDriver(getFirefoxOptions());\n    }\n\n    private FirefoxOptions getFirefoxOptions() {\n        FirefoxOptions options = new FirefoxOptions();\n        options.addPreference(JAVASCRIPT_ENABLED, false);\n        return options;\n    }\n</code></pre>\n<p>The complete code can be found on<br>my <a href=\"https://github.com/slawekradzyminski/AwesomeTesting/commit/68cdb2c98a8282e8b48d79fcbcc8ced3b12def92\" target=\"_blank\" rel=\"noreferrer\">GitHub project</a>.</p>\n<p>Image credit: <a href=\"https://tomthedev.com/blog-page/is-there-a-life-without-javascript\" target=\"_blank\" rel=\"noreferrer\">tomthedev</a></p>\n"
}