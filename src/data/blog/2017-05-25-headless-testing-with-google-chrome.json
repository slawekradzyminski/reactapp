{
  "id": "2017-05-25-headless-testing-with-google-chrome",
  "title": "Headless testing with Google Chrome",
  "date": "2017-05-25",
  "category": "Selenium",
  "permalink": "/2017/05/headless-testing-with-google-chrome",
  "content": "<img src=\"/images/blog/suit-158820_1280.png\" alt=\"\">\n\n<p>Headless Testing means running a browser UI test without the graphical user interface, i.e. without the head. Such a test requires a headless browser, which (according to <a href=\"https://en.wikipedia.org/wiki/Headless_browser\" target=\"_blank\" rel=\"noreferrer\">Wikipedia</a>) provides automated control of a web page in an environment similar to popular web browsers, but are executed via a command-line interface or using network communication. They are particularly useful for testing web pages as they are able to render and understand HTML the same way a browser would, including styling elements such as page layout, colour, font selection and execution of JavaScript and AJAX which are usually not available when using other testing methods.</p><p>Why would we want to execute UI tests in headless browser?</p><p>The main reason is continuous integration. We might not always have a display output (X-server) installed. For example all unix systems (that usually act as enterprise CI servers) don&#39;t have it by default. Let&#39;s say you have Jenkins installed on amazon EC2 ubuntu instance. In order to run UI tests there you need <a href=\"http://elementalselenium.com/tips/38-headless\" target=\"_blank\" rel=\"noreferrer\">Xvfb installation + configuration</a>. Headless testing requires browser only.</p><h2>Headless browsers overview</h2>\n<p>As for today <a href=\"https://github.com/ariya/phantomjs\" target=\"_blank\" rel=\"noreferrer\">PhantomJS</a> is an unquestionable leader. Unfortunately the project has more than 1800 open issues and its maintainer has <a href=\"https://groups.google.com/forum/#!topic/phantomjs/9aI5d-LDuNE\" target=\"_blank\" rel=\"noreferrer\">just announced</a> that he will no longer support it. The main reason being:</p><blockquote class=\"blog-quote\"><p>Headless Chrome is coming (...) I think people will switch to it, eventually. Chrome is faster and more stable than PhantomJS. And it doesn&#39;t eat memory like crazy.</p><p></p></blockquote><p>Headless mode would be added into Google Chrome in <a href=\"https://www.chromestatus.com/features/5678767817097216\" target=\"_blank\" rel=\"noreferrer\">version 59</a>.</p><p>Firefox <a href=\"https://bugzilla.mozilla.org/show_bug.cgi?id=1338004\" target=\"_blank\" rel=\"noreferrer\">is planning</a> to introduce it as well.</p><h2>Prerequisites for running headless tests on Chrome</h2>\n<p>I managed to run headless test on my Mac. Prerequisites require only two steps:</p><p>a) downloading <a href=\"https://chromedriver.storage.googleapis.com/index.html?path=2.29/\" target=\"_blank\" rel=\"noreferrer\">ChromeDriver 2.29</a><br><br>b) downloading <a href=\"https://www.chromium.org/getting-involved/dev-channel\" target=\"_blank\" rel=\"noreferrer\">Google Chrome 59</a> (beta currently)</p><h2>Demo in Java</h2>\n<p>As usual I prepared a demo on my <a href=\"https://github.com/slawekradzyminski/AwesomeTesting/commit/7f13e2f5f8f2253ccfcd8c6bafd393661526a7e3\" target=\"_blank\" rel=\"noreferrer\">GitHub project</a>. It was a lot easier this time - I used example test from <a href=\"http://www.awesome-testing.com/2016/04/introducing-fluentlenium-2-selenium.html\" target=\"_blank\" rel=\"noreferrer\">Selenium Waiting Game post</a>and Chrome Manipulation code from <a href=\"http://www.awesome-testing.com/2016/02/selenium-browser-capabilities-explained.html\" target=\"_blank\" rel=\"noreferrer\">Browser Capabilities Explained post</a>. I&#39;m using <a href=\"http://fluentlenium.org/\" target=\"_blank\" rel=\"noreferrer\">FluentLenium</a> syntax.</p><p>Turns out, all you need to do is add &#39;headless&#39; option into Chrome BrowserCapabilites.</p><p>Test:</p><pre><code class=\"hljs language-java\">\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">HeadlessChromeTest</span> <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title class_\">HeadlessChromeConfig</span> {\n\n    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">final</span> <span class=\"hljs-type\">String</span> <span class=\"hljs-variable\">URL</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-string\">&quot;https://resttesttest.com/&quot;</span>;\n    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">final</span> <span class=\"hljs-type\">String</span> <span class=\"hljs-variable\">SUCCESS_TEXT</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-string\">&quot;HTTP 200 OK&quot;</span>;\n\n    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">final</span> <span class=\"hljs-type\">String</span> <span class=\"hljs-variable\">AJAX_BUTTON_CSS</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-string\">&quot;#submitajax&quot;</span>;\n    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">final</span> <span class=\"hljs-type\">String</span> <span class=\"hljs-variable\">ALERT_RESULT_CSS</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-string\">&quot;.alert-success&quot;</span>;\n\n    <span class=\"hljs-meta\">@Test</span>\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">ajaxCallTest</span><span class=\"hljs-params\">()</span> {\n        goTo(URL);\n        await().until(el(AJAX_BUTTON_CSS)).clickable();\n        el(AJAX_BUTTON_CSS).click();\n        await().atMost(<span class=\"hljs-number\">5</span>, TimeUnit.SECONDS).untilPredicate(ajaxCallCompleted);\n        assertThat(el(ALERT_RESULT_CSS).text()).isEqualTo(SUCCESS_TEXT);\n    }\n\n    <span class=\"hljs-keyword\">private</span> Predicate&lt;FluentControl&gt; ajaxCallCompleted = fluent -&gt; {\n        <span class=\"hljs-keyword\">final</span> <span class=\"hljs-type\">JavascriptExecutor</span> <span class=\"hljs-variable\">driver</span> <span class=\"hljs-operator\">=</span> (JavascriptExecutor) getDriver();\n        <span class=\"hljs-keyword\">return</span> (Boolean) driver\n                .executeScript(<span class=\"hljs-string\">&quot;return (window.jQuery != null) &amp;&amp; (jQuery.active === 0);&quot;</span>);\n    };\n\n}\n</code></pre><p>ChromeDriver runner:</p><pre><code class=\"hljs language-java\">\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">HeadlessChromeConfig</span> <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title class_\">FluentTestNg</span> {\n\n    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">final</span> <span class=\"hljs-type\">String</span> <span class=\"hljs-variable\">HEADLESS</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-string\">&quot;headless&quot;</span>;\n\n    <span class=\"hljs-meta\">@Override</span>\n    <span class=\"hljs-keyword\">public</span> WebDriver <span class=\"hljs-title function_\">newWebDriver</span><span class=\"hljs-params\">()</span> {\n        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">ChromeDriver</span>(getChromeCapabilities());\n    }\n\n    <span class=\"hljs-keyword\">private</span> DesiredCapabilities <span class=\"hljs-title function_\">getChromeCapabilities</span><span class=\"hljs-params\">()</span> {\n        <span class=\"hljs-type\">DesiredCapabilities</span> <span class=\"hljs-variable\">capabilities</span> <span class=\"hljs-operator\">=</span> DesiredCapabilities.chrome();\n        capabilities.setCapability(ChromeOptions.CAPABILITY, getChromeOptions());\n        <span class=\"hljs-keyword\">return</span> capabilities;\n    }\n\n    <span class=\"hljs-keyword\">private</span> ChromeOptions <span class=\"hljs-title function_\">getChromeOptions</span><span class=\"hljs-params\">()</span> {\n        <span class=\"hljs-type\">ChromeOptions</span> <span class=\"hljs-variable\">options</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">ChromeOptions</span>();\n        options.addArguments(getChromeSwitches());\n        <span class=\"hljs-keyword\">return</span> options;\n    }\n\n    <span class=\"hljs-keyword\">private</span> List&lt;String&gt; <span class=\"hljs-title function_\">getChromeSwitches</span><span class=\"hljs-params\">()</span> {\n        List&lt;String&gt; chromeSwitches = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">ArrayList</span>&lt;&gt;();\n        chromeSwitches.add(HEADLESS);\n        <span class=\"hljs-keyword\">return</span> chromeSwitches;\n    }\n\n}\n</code></pre><p>Try it on your own. You should see no GUI and the test should pass. Now comment out line 24 (adding &#39;headless&#39; switch) and you should see real Chrome.</p><p>All code from my technical posts is available and maintained on my <a href=\"https://github.com/slawekradzyminski/AwesomeTesting\" target=\"_blank\" rel=\"noreferrer\">GitHub project</a>. Check it out for more details and subscribe to updates.<br></p><p><strong>Update:</strong> Headless Chrome doesn&#39;t work on Windows yet. Big thanks for <a href=\"https://twitter.com/rafalfusik\" target=\"_blank\" rel=\"noreferrer\">@rafalfusik</a>. See link for details.</p><blockquote class=\"blog-quote\"><p><strong><a href=\"https://twitter.com/s_radzyminski\" target=\"_blank\" rel=\"noreferrer\">@s_radzyminski</a> <a href=\"https://t.co/hW8x2l9vVW\" target=\"_blank\" rel=\"noreferrer\">https://t.co/hW8x2l9vVW</a></strong></p><p></p><p></p><p></p><p><strong>â€” rafalfusik (@rafalfusik) <a href=\"https://twitter.com/rafalfusik/status/861151982379204608\" target=\"_blank\" rel=\"noreferrer\">May 7, 2017</a></strong></p><p></p></blockquote><p><strong>Update2:</strong> Google Chrome Developer tools support details - <a href=\"https://developers.google.com/web/updates/2017/04/headless-chrome\" target=\"_blank\" rel=\"noreferrer\">article from official blog</a>.</p>"
}