{
  "id": "2017-02-12-continuous-security-with-owasp-dependency-check",
  "title": "Continuous Security with OWASP Dependency Check",
  "date": "2017-02-12",
  "category": "Security",
  "permalink": "/2017/02/continuous-security-with-owasp",
  "content": "<p><a href=\"https://3.bp.blogspot.com/-_QCu2SgaOKI/WIzMr-ktv4I/AAAAAAAAClU/QFKEe7uMhBw0TCW_vaWTKWX5AsCUy4tTQCLcB/s1600/pobrane%2B%25281%2529.png\" target=\"_blank\" rel=\"noreferrer\"><img src=\"https://3.bp.blogspot.com/-_QCu2SgaOKI/WIzMr-ktv4I/AAAAAAAAClU/QFKEe7uMhBw0TCW_vaWTKWX5AsCUy4tTQCLcB/s400/pobrane%2B%25281%2529.png\" alt=\"Dependency Check logo\"></a></p><h2>OWASP Dependency Check as a Continuous Security tool</h2>\n<p>In my <a href=\"http://www.awesome-testing.com/2016/10/testops-3-continuous-testing.html\" target=\"_blank\" rel=\"noreferrer\">Continuous Testing post</a> I introduced you with an idea of Continuous Security. Those are automatic and repeatable tests which look for vulnerabilities in your application. They should be run as often as possible (ideally after each commit). In case of failure build pipeline should be stopped and person who introduced breaking changes should investigate what went wrong.</p><p>OWASP Dependency Check is one of the most popular continuous security tool. It takes your dependencies as an input,<br>compares them with local vulnerabilities database and produces vulnerability report as a output. Integration is pretty easy and potential benefits significant - you may be surprised how often even most popular open source libraries have security flaws.</p><h2>OWASP Top 10 A9 - Using components with known vulnerabilities</h2>\n<p>Why bother?</p><p>According to <a href=\"https://www.owasp.org/images/f/f8/OWASP_Top_10_-_2013.pdf\" target=\"_blank\" rel=\"noreferrer\">OWASP Top 10</a> using components with known vulnerabilities is widespread. Almost every application has those issues because most development teams don&#39;t pay much attention to project dependencies. Libraries are often added to speed up development and never updated. This obviously creates risks. Even famous Spring wasn&#39;t an exception allowing <a href=\"https://pivotal.io/security/cve-2016-4977\" target=\"_blank\" rel=\"noreferrer\">remote code execution</a> in it&#39;s Security OAuth.</p><p>Full range of weaknesses is possible (XSS, injections, broken access control, etc) and this subject shouldn&#39;t be ignored.</p><h2>OWASP Dependency Check Maven plugin</h2>\n<p>Let&#39;s get down to business. I&#39;ll show you how to integrate OWASP Dependency Check using my <a href=\"https://github.com/slawekradzyminski/AwesomeTesting\" target=\"_blank\" rel=\"noreferrer\">AwesomeTesting GitHub project</a>where I store and maintain every line of code ever written on this blog.</p><p>All you need to do is to add Dependency Check to your pom and run one command. For a start it&#39;s better to not integrate it into Continuous Delivery pipeline. That&#39;s why I&#39;m keeping it in separate <em>security</em> profile.</p><pre><code class=\"hljs language-plaintext\">\n        &lt;profile&gt;\n            &lt;id&gt;security&lt;/id&gt;\n            &lt;build&gt;\n                &lt;plugins&gt;\n                    &lt;plugin&gt;\n                        &lt;groupId&gt;org.owasp&lt;/groupId&gt;\n                        &lt;artifactId&gt;dependency-check-maven&lt;/artifactId&gt;\n                        &lt;version&gt;1.4.5&lt;/version&gt;\n                        &lt;executions&gt;\n                            &lt;execution&gt;\n                                &lt;goals&gt;\n                                    &lt;goal&gt;check&lt;/goal&gt;\n                                &lt;/goals&gt;\n                            &lt;/execution&gt;\n                        &lt;/executions&gt;\n                    &lt;/plugin&gt;\n                &lt;/plugins&gt;\n            &lt;/build&gt;\n        &lt;/profile&gt;\n</code></pre><p>In order to start scanning run:</p><p><code>mvn -P security dependency-check:check</code></p><p>This is how console output should look like (first run would be significantly longer, because whole database of <a href=\"https://web.nvd.nist.gov/\" target=\"_blank\" rel=\"noreferrer\">National Vulnerability Database</a> has to be downloaded).</p><pre><code class=\"hljs language-plaintext\">\ns.radzyminski@ ~/I/s/AwesomeTestingBlog&gt; mvn -P security dependency-check:check\n[INFO] Scanning for projects...\n[INFO] ------------------------------------------------------------------------\n[INFO] Building AwesomeTesting 1.0-SNAPSHOT\n[INFO] ------------------------------------------------------------------------\n[INFO]\n[INFO] --- dependency-check-maven:1.4.5:check (default-cli) @ AwesomeTesting ---\n[INFO] Checking for updates\n[INFO] Download Started for NVD CVE - Modified\n[INFO] Download Complete for NVD CVE - Modified  (2775 ms)\n[INFO] Processing Started for NVD CVE - Modified\n[INFO] Processing Complete for NVD CVE - Modified  (1712 ms)\n[INFO] Begin database maintenance.\n[INFO] End database maintenance.\n[INFO] Check for updates complete (24674 ms)\n[INFO] Analysis Started\n[INFO] Finished Archive Analyzer (0 seconds)\n[INFO] Finished File Name Analyzer (0 seconds)\n[INFO] Finished Jar Analyzer (0 seconds)\n[INFO] Finished Central Analyzer (2 seconds)\n[ERROR] ----------------------------------------------------\n[ERROR] .NET Assembly Analyzer could not be initialized and at least one &#x27;exe&#x27; or &#x27;dll&#x27; was scanned. The &#x27;mono&#x27; executable could not be found on the path; either disable the Assembly Analyzer or configure the path mono. On some systems mono-runtime and mono-devel need to be installed.\n[ERROR] ----------------------------------------------------\n[INFO] Finished Dependency Merging Analyzer (0 seconds)\n[INFO] Finished Version Filter Analyzer (0 seconds)\n[INFO] Finished Hint Analyzer (0 seconds)\n[INFO] Created CPE Index (1 seconds)\n[INFO] Finished CPE Analyzer (2 seconds)\n[INFO] Finished False Positive Analyzer (0 seconds)\n[INFO] Finished Cpe Suppression Analyzer (0 seconds)\n[INFO] Finished NVD CVE Analyzer (0 seconds)\n[INFO] Finished Vulnerability Suppression Analyzer (0 seconds)\n[INFO] Finished Dependency Bundling Analyzer (0 seconds)\n[INFO] Analysis Complete (8 seconds)\n[WARNING]\n\nOne or more dependencies were identified with known vulnerabilities in AwesomeTesting:\n\ncommons-collections-3.1.jar (commons-collections:commons-collections:3.1, cpe:/a:apache:commons_collections:3.1) : CVE-2015-6420 netty-3.5.7.Final.jar (cpe:/a:netty_project:netty:3.5.7, io.netty:netty:3.5.7.Final) : CVE-2014-3488 groovy-2.4.6.jar (cpe:/a:apache:groovy:2.4.6, org.codehaus.groovy:groovy:2.4.6) : CVE-2016-6497 selenium-opera-driver-3.0.1.jar (cpe:/a:opera:opera:3.0.1, org.seleniumhq.selenium:selenium-opera-driver:3.0.1) : CVE-2016-7152, CVE-2015-8960, CVE-2010-5227, CVE-2009-2068, CVE-2009-0915, CVE-2008-5679, CVE-2008-4795, CVE-2008-4794, CVE-2008-4696, CVE-2008-4695, CVE-2008-4293, CVE-2008-3172, CVE-2008-3079, CVE-2008-1764, CVE-2008-1761, CVE-2003-1561\n\n\nSee the dependency-check report for more details.\n\n\n[INFO] ------------------------------------------------------------------------\n[INFO] BUILD SUCCESS\n[INFO] ------------------------------------------------------------------------\n[INFO] Total time: 36.077 s\n[INFO] Finished at: 2017-02-02T18:10:24+01:00\n[INFO] Final Memory: 31M/1337M\n[INFO] ------------------------------------------------------------------------\n</code></pre><p>As you can see few libraries I use in a project have known vulnerabilities. In addition, OWASP Dependency Check creates nicely formatted .html report which you can see in full details <a href=\"http://htmlpreview.github.io/?https://github.com/slawekradzyminski/AwesomeTesting/blob/master/dependency-check-report.html\" target=\"_blank\" rel=\"noreferrer\">here</a>.</p><p>Every single vulnerability is nicely explained with full description and links which contain detailed info. Affected versions are also included. As a tester you would probably be interested in testing it - try upgrading commons-collections to 3.2.2 and you would observe that vulnerability is no longer reported.</p><img src=\"/images/blog/commons.jpg\" alt=\"\">\n\n<h2>Ignoring False Positives</h2>\n<p>Unfortunately as almost every test automation tool Dependency Check isn&#39;t free from false positives. After reading detailed report you may conclude that your application doesn&#39;t use vulnerable code and suppress reporting for given library. Here are two simple steps to ignore commons-collections 3.1 from reporting.</p><p>a) You need to create ignore file (it&#39;s created automatically by clicking suppress on <a href=\"http://htmlpreview.github.io/?https://github.com/slawekradzyminski/AwesomeTesting/blob/master/dependency-check-report.html\" target=\"_blank\" rel=\"noreferrer\">.html report</a>)</p><pre><code class=\"hljs language-plaintext\">\n&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;\n&lt;suppressions xmlns=&quot;https://www.owasp.org/index.php/OWASP_Dependency_Check_Suppression&quot;\n              xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;\n              xsi:schemaLocation=&quot;https://www.owasp.org/index.php/OWASP_Dependency_Check_Suppression &quot;&gt;\n    &lt;suppress&gt;\n        &lt;notes&gt;&lt;![CDATA[\n   file name: commons-collections-3.1.jar\n   ]]&gt;&lt;/notes&gt;\n        &lt;gav regex=&quot;true&quot;&gt;^commons-collections:commons-collections:.*$&lt;/gav&gt;\n        &lt;cve&gt;CVE-2015-6420&lt;/cve&gt;\n    &lt;/suppress&gt;\n&lt;/suppressions&gt;\n</code></pre><p>b) Provide a path in pom.xml</p><pre><code class=\"hljs language-plaintext\">\n                    &lt;plugin&gt;\n                        &lt;groupId&gt;org.owasp&lt;/groupId&gt;\n                        &lt;artifactId&gt;dependency-check-maven&lt;/artifactId&gt;\n                        &lt;version&gt;1.4.5&lt;/version&gt;\n                        &lt;configuration&gt;\n                            &lt;suppressionFile&gt;src/test/resources/ignore.xml&lt;/suppressionFile&gt;\n                        &lt;/configuration&gt;\n                        &lt;executions&gt;\n                            &lt;execution&gt;\n                                &lt;goals&gt;\n                                    &lt;goal&gt;check&lt;/goal&gt;\n                                &lt;/goals&gt;\n                            &lt;/execution&gt;\n                        &lt;/executions&gt;\n                    &lt;/plugin&gt;\n</code></pre><h2>OWASP Dependency Check in Continuous Integration</h2>\n<p>After full vulnerable dependencies investigation and ignoring false positives you can integrate OWASP Dependency Check into Continuous Delivery pipeline. Let&#39;s say you want to be notified if new vulnerability had been discovered. Just add _mvn dependency-check:check_as a build step and set failBuildOnCVSS value. Build would now fail if something new pops out.</p><pre><code class=\"hljs language-plaintext\">\n                    &lt;plugin&gt;\n                        &lt;groupId&gt;org.owasp&lt;/groupId&gt;\n                        &lt;artifactId&gt;dependency-check-maven&lt;/artifactId&gt;\n                        &lt;version&gt;1.4.5&lt;/version&gt;\n                        &lt;configuration&gt;\n                            &lt;failBuildOnCVSS&gt;1&lt;/failBuildOnCVSS&gt;\n                            &lt;suppressionFile&gt;src/test/resources/ignore.xml&lt;/suppressionFile&gt;\n                        &lt;/configuration&gt;\n                        &lt;executions&gt;\n                            &lt;execution&gt;\n                                &lt;goals&gt;\n                                    &lt;goal&gt;check&lt;/goal&gt;\n                                &lt;/goals&gt;\n                            &lt;/execution&gt;\n                        &lt;/executions&gt;\n                    &lt;/plugin&gt;\n</code></pre><p><a href=\"http://htmlpreview.github.io/?https://github.com/slawekradzyminski/AwesomeTesting/blob/master/dependency-check-report.html\" target=\"_blank\" rel=\"noreferrer\">Visual .html</a><br>reporting can be nicely integrated into your CI tool. Here is example screenshot from TeamCity.</p><img src=\"/images/blog/dependencycheck.jpg.png\" alt=\"\">\n\n<h2>Conclusions</h2>\n<p>OWASP Dependency Check is a quick win tool. With ever growing security concerns and free powerful hacking tools testers would be pushed more and more into pentesting. You can start doing it today with my easy to adopt guide.</p><p><a href=\"https://github.com/slawekradzyminski/AwesomeTesting\" target=\"_blank\" rel=\"noreferrer\">Follow my project on GitHub</a> to be notified of new stuff before all the others.</p><h2>Further Reading</h2>\n<p><a href=\"http://www.awesome-testing.com/2016/10/testops-3-continuous-testing.html\" target=\"_blank\" rel=\"noreferrer\">TestOps #3 - Continuous Testing</a><br><br><a href=\"https://www.owasp.org/index.php/Category:OWASP_Top_Ten_Project\" target=\"_blank\" rel=\"noreferrer\">OWASP Top 10</a><br><br><a href=\"https://www.owasp.org/images/e/e1/OWASP-Continuous_Security_Testing.pdf\" target=\"_blank\" rel=\"noreferrer\">OWASP Continuous Security Testing</a><br><br><a href=\"https://www.owasp.org/index.php/OWASP_Dependency_Check\" target=\"_blank\" rel=\"noreferrer\">OWASP Dependency Check</a><br><br><a href=\"https://nvd.nist.gov/\" target=\"_blank\" rel=\"noreferrer\">National Vulnerability Database - NIST</a></p>"
}